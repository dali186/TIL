카나리 배포, 블루/그린 배포
### 가상화
> 가짜(not real) 하드웨어 환경을 만들어 내는 기술로, 실제 물리장비인 **호스트**와 가상머신인 **게스트**를 **구분**합니다.
![[Virtualization.png.png]]
##### 하이퍼바이저 가상화
- 한 대의 머신에서 다수의 운영체제를 동시에 실행하는 소프트웨어로, 하드웨어를 가상화한다.
##### 컨테이너 가상화
- 애플리케이션 구동에 필요한 모든 것을 패키징 및 **격리된 환경**에서 실행
- 프로세스 간 서로를 격리시키고 각자 필요한 환경을 꾸려서 실행하는 방법
	- 공유 자원(Cpu, memory, network...)에 대해서 프로세스별로 할당치 만큼 사용하도록 제한
- 누군가 자원을 과도하게 소비하여 피해를 주는 일을 방지
![[VMversusContainer.png.png]]
###### Virtual Machine
- `Host OS` - `Hypervisor` - `Guest OS`
- OS 단위로 격리
- Guest OS 사용
	- 하드웨어 사용 시, Hypervisor의 처리를 기다려야 함.
###### Container
- **Process 단위로 격리**
- Host OS 사용

**`/tmp`**
- **임시 파일 저장소**입니다.
- 일반적으로 **시스템 재부팅 시 자동으로 비워집니다**.
- **모든 사용자**가 접근 가능하지만, **파일마다 권한이 따로 설정**됩니다.
- 많은 프로그램들이 설치나 실행 도중 임시 파일을 저장할 때 사용합니다.
**`/var/tmp`**
- `/tmp`와 비슷하지만, **재부팅 후에도 파일이 남아 있습니다.**
- 오래 유지해야 하는 임시 파일에 적합.

**chroot**
chroot으로 들어온 프로세스는 해당 chroot가 최상위 디렉터리로 인식하여 그 상위인 루트로 올라가지 못한다.

 > 사용자에게 제공하고 싶은 프로그램을 한 곳에 모으고, 사용자 프로세스가 활동할 수 있는 경로를 제한해서 실행한 것이 컨테이너의 초창기 모습
 

위에서 Container는 프로세스 단위로 격리한다고 설명했다.
##### chroot
- 프로세스의 루트 디렉터리를 변경하는 리눅스 시스템콜
- 원격 유저(FTP, SSH 등)을 특정 디렉터리에 가두기 위한 용도로 사용
	- chroot에 갇힌 프로세스는 현대 디렉터리를 루트로 인식하여 외부로 나갈 수 없음
**chroot 디렉터리 만들기**
*경로 => 복사 => 실행*
1. 디렉터리 생성
2. 커맨드(/bin/bash) cp + 의존성 라이브러리 cp
3. chroot 실행

위 과정(경로 => 복사) 가 본거로움 => **`이미지`** 로 간단하게 묶어둠
> **프로그램 실행에 필요한 파일들을 모아놓고 해당 경로를 root로 하여 프로세스를 실행**

지만... chroot는 컨테이너롤 사용되지 않음
1. 탈옥이 가능
2. 격리되지 않음 (루트권한을 가진 프로세스는 모두 chroot 경로에 접근이 가능)
3. 루트 권한 제어 필요 (chroot를 사용하기 위해서는 root권한이 필요)
4. 리소스 제한 안됨 (특정 컨테이너에서의 과도한 리소스 사용이 다른 프로세스에게 영향을 줌)

**대체 `pivot_root`**
- "마운트 네임스페이스"는 특정 프로세스에 대해 마운트를 호스트와 격리하는 것으로, 컨테이너 내부의 마운트 변경 사항이나 마운트된 파일시스템 및 파일시스템 내부의 파일 변경 사항들이 호스트에서는 보이지 않습니다.
- 따라서 루트 파일시스템을 pivot_root로 바꾸더라도(즉, 마운트 포인트가 바뀌더라도) 마운트를 호스트와 격리했기 때문에 호스트에는 전혀 영향을 미치지 않고, 컨테이너 안에서만 새로운 루트 파일시스템으로 바뀌게 됩니다.
