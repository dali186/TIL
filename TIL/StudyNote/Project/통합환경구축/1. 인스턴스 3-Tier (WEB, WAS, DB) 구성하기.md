#### 1. 인스턴스 생성
---
**`WEB`**
1. 구독: `Azure for Students`
2. 리소스 그룹: (신규) Infra-env
3. VM명: Infra-env-web
4. OS: Ubuntu Server 20.04 LTS
5. 플랜: Standard_B1ls
6. 관리자 계정: infra-admin
7. 키 쌍 이름: infra-env-key-01(RSA SSH)
![[infra-env-key-01.pem]]
8. 네트워크 그룹 설정  (IP: 4.230.0.14)

**`WAS`**
1. 구독: `Azure for Students`
2. 리소스 그룹: Infra-env
3. VM명: Infra-env-was
4. OS: Ubuntu Server 20.04 LTS
5. 플랜: Standard_B1ls
6. 관리자 계정: infra-admin
7. 키 쌍 이름: infra-env-key-01(RSA SSH)
![[infra-env-key-01.pem]]
8. 네트워크 그룹 설정 (IP: 20.39.200.90)

**`DB`**
1. 구독: `Azure for Students`
2. 리소스 그룹: Infra-env
3. VM명: Infra-env-db
4. OS: Ubuntu Server 20.04 LTS
5. 플랜: Standard_B1ls
6. 관리자 계정: infra-admin
7. 키 쌍 이름: infra-env-key-01(RSA SSH)
![[infra-env-key-01.pem]]
8. 네트워크 그룹 설정 (IP: 20.39.204.186)

#### 2. 네트워크 설정
---
**가상 네트워크 토폴로지: Infra-env-web-vnet**
![[Vnet-topology-01.png]]
`Virtural Machine - Network Interface`
`Network Interface - Virtual Machine`
`Network Interface - Ip Config`
`Network Interface - NetworkSecurityGroups`
`Ip Config - Public Ip Address`

#### 3. WEB/WAS/DB 설정
---
##### 1. WEB 설정
```
apt-get install apache2
systemctl start apache2
# 방화벽 설정
ufw app list
ufw allow 'Apache'
ufw allow 80/tcp
ufw enable
```
인바운드 포트를 Network Security Group에서 열어도 적용이 안됨 -> VM.네트워크 설정에서 적용

##### 2. WAS 설정
**Spring**
```
# JDK 설정
update-alternatives --config java

apt update
apt install openjdk-17-jdk
java -version
sudo vi /etc/enviroment
{JAVA_HOME="usr/lib/jvm/java-17-openjdk-amd64"}
source /etc/enviroment

./gradlew clean build
./gradlew build -x test

```
[gradle과 gradlew의 차이점](https://velog.io/@hyeonwoody/Javagradle%EA%B3%BC-gradlew-%EC%B0%A8%EC%9D%B4)
```
java -jar build/libs/Cloud-Demo-0.0.1-SNAPSHOT.jar
# &, 백그라운드로 실행
nohup java -jar build/libs/Cloud-Demo-0.0.1-SNAPSHOT.jar > app.log 2>&1 &
```

**WEB - WAS 간 연결**
1. WEB에서 아웃바운드를 열어준다.(8080)
2. WAS에서 인바운드를 열어준다.(8080)
3. WEB에서 `mod_jk`, `mod_proxy`, `mod_porxy_ajp` 중 택일
- [Ref. mod_jk 설정](https://velog.io/@sot_sky/mod-jk%EB%A1%9C-Ubuntu22%EC%84%9C%EB%B2%84%EC%97%90%EC%84%9C-%EC%95%84%ED%8C%8C%EC%B9%98-%ED%86%B0%EC%BA%A3-%EC%97%B0%EB%8F%99%ED%95%98%EA%B8%B0)
```
# mod_jk 설정
apt-get install libapache2-mod-jk
vi /etc/libapache2-mod-jk/workers.properties
```